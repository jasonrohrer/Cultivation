#!/bin/bash

#
# Modification History
#
# 2006-June-27    Jason Rohrer
# Copied/modified from Transcend project.  Dropped a platforms that were only
# nominally supported.
#
# 2007-Dec-11 Jose Jorge
# Added platform switches which allow us to skip the interactive menu.
#

case $1 in

    "--linux")
        platformSelection=1
    ;;

    "--macosx")
        platformSelection=2
    ;;

    "--win32")
        platformSelection=3
    ;;

    "--help")
        echo "Use the following switches to skip interactive mode:"
        echo "--linux"
        echo "--macosx"
        echo "--win32"
        exit
    ;;

esac

while [ -z "$platformSelection" ]
do
    echo "select platform:"
    
    echo "  1 --  GNU/Linux"
    echo "  2 --  MacOSX"
    echo "  3 --  Win32 using MinGW"
    echo "  q --  quit"
    
    echo ""
    echo -n "> "
    
    read platformSelection
    
    if [ "$platformSelection" = "q" ]
    then
        exit
    fi


    # use ASCII comparison.

    if [[ "$platformSelection" > "3" ]]
    then
        platformSelection=""
    fi

    if [[ "$platformSelection" < "1" ]]
    then
        platformSelection=""
    fi

done


# use partial makefiles from minorGems project
makefileMinorGems="../minorGems/build/Makefile.minorGems"
makefileMinorGemsTargets="../minorGems/build/Makefile.minorGems_targets"



platformName="Generic"
platformMakefile="generic"



case "$platformSelection" in


    "1" )
        platformName="GNU/Linux"
        platformMakefile="Makefile.GnuLinux"
    ;;


    "2" )
        platformName="MacOSX"
        platformMakefile="Makefile.MacOSX"
    ;;


    "3" )
        platformName="Win32 MinGW"
        platformMakefile="Makefile.MinGW"
    ;;


esac



rm -f Makefile.temp
echo "# Auto-generated by game2/configure for the $platformName platform.  Do not edit manually." > Makefile.temp

rm -f gameSource/Makefile
cat Makefile.temp $platformMakefile Makefile.common $makefileMinorGems gameSource/Makefile.all $makefileMinorGemsTargets > gameSource/Makefile


rm Makefile.temp



exit

